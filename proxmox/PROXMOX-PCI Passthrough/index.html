<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Obsidian How-To Guides served with MkDocs + Material"><meta name=author content=DirtyOptics><link href=../../raspberry-pi/rpi5-setup/ rel=prev><link href=../backup-restore/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>PCI Passthrough - Airbreach</title><link rel=stylesheet href=../../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-proxmox-pcigpu-passthrough class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Airbreach class="md-header__button md-logo" aria-label=Airbreach data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Airbreach </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> PCI Passthrough </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../networking/setup-nanostation/ class=md-tabs__link> Networking </a> </li> <li class=md-tabs__item> <a href=../../raspberry-pi/enable-vnc/ class=md-tabs__link> Raspberry Pi </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Proxmox </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Airbreach class="md-nav__button md-logo" aria-label=Airbreach data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Airbreach </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Networking </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Networking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../networking/setup-nanostation/ class=md-nav__link> <span class=md-ellipsis> Setup Nanostation </span> </a> </li> <li class=md-nav__item> <a href=../../networking/advanced-routing/ class=md-nav__link> <span class=md-ellipsis> Advanced Routing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Raspberry Pi </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Raspberry Pi </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../raspberry-pi/enable-vnc/ class=md-nav__link> <span class=md-ellipsis> Enable VNC </span> </a> </li> <li class=md-nav__item> <a href=../../raspberry-pi/performance-tuning/ class=md-nav__link> <span class=md-ellipsis> Performance Tuning </span> </a> </li> <li class=md-nav__item> <a href=../../raspberry-pi/rpi5-setup/ class=md-nav__link> <span class=md-ellipsis> RPi5 Setup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Proxmox </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Proxmox </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> PCI Passthrough </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> PCI Passthrough </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> ğŸ“– Overview </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#step-by-step-guide class=md-nav__link> <span class=md-ellipsis> ğŸ§© Step-by-Step Guide </span> </a> <nav class=md-nav aria-label="ğŸ§© Step-by-Step Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-prepare-bios class=md-nav__link> <span class=md-ellipsis> Step 1: Prepare BIOS </span> </a> </li> <li class=md-nav__item> <a href=#step-2-setting-boot-arguments class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Step 2: Setting Boot Arguments </span> </a> <nav class=md-nav aria-label="ğŸ”§ Step 2: Setting Boot Arguments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-intel-cpus class=md-nav__link> <span class=md-ellipsis> For Intel CPUs </span> </a> </li> <li class=md-nav__item> <a href=#for-amd-cpus class=md-nav__link> <span class=md-ellipsis> For AMD CPUs </span> </a> </li> <li class=md-nav__item> <a href=#intel-cpus-systemdzfs class=md-nav__link> <span class=md-ellipsis> Intel CPUs (Systemd/ZFS) </span> </a> </li> <li class=md-nav__item> <a href=#amd-cpus-systemdzfs class=md-nav__link> <span class=md-ellipsis> AMD CPUs (Systemd/ZFS) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-3-configuring-iommu class=md-nav__link> <span class=md-ellipsis> âœï¸ Step 3: Configuring IOMMU </span> </a> </li> <li class=md-nav__item> <a href=#step-4-blacklisting-driver-modules class=md-nav__link> <span class=md-ellipsis> ğŸš€ Step 4: Blacklisting Driver modules </span> </a> <nav class=md-nav aria-label="ğŸš€ Step 4: Blacklisting Driver modules"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-device-ids-to-blacklist class=md-nav__link> <span class=md-ellipsis> Adding Device ID's to Blacklist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-4-adding-devices-to-vm class=md-nav__link> <span class=md-ellipsis> â³ Step 4: Adding devices to VM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> â— Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> <span class=md-ellipsis> ğŸ“š Resources </span> </a> </li> <li class=md-nav__item> <a href=#revision-history class=md-nav__link> <span class=md-ellipsis> ğŸ”„ Revision History </span> </a> </li> <li class=md-nav__item> <a href=#additional-notes class=md-nav__link> <span class=md-ellipsis> ğŸ“ Additional Notes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../backup-restore/ class=md-nav__link> <span class=md-ellipsis> Backup and Restore </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> ğŸ“– Overview </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#step-by-step-guide class=md-nav__link> <span class=md-ellipsis> ğŸ§© Step-by-Step Guide </span> </a> <nav class=md-nav aria-label="ğŸ§© Step-by-Step Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-prepare-bios class=md-nav__link> <span class=md-ellipsis> Step 1: Prepare BIOS </span> </a> </li> <li class=md-nav__item> <a href=#step-2-setting-boot-arguments class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Step 2: Setting Boot Arguments </span> </a> <nav class=md-nav aria-label="ğŸ”§ Step 2: Setting Boot Arguments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-intel-cpus class=md-nav__link> <span class=md-ellipsis> For Intel CPUs </span> </a> </li> <li class=md-nav__item> <a href=#for-amd-cpus class=md-nav__link> <span class=md-ellipsis> For AMD CPUs </span> </a> </li> <li class=md-nav__item> <a href=#intel-cpus-systemdzfs class=md-nav__link> <span class=md-ellipsis> Intel CPUs (Systemd/ZFS) </span> </a> </li> <li class=md-nav__item> <a href=#amd-cpus-systemdzfs class=md-nav__link> <span class=md-ellipsis> AMD CPUs (Systemd/ZFS) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-3-configuring-iommu class=md-nav__link> <span class=md-ellipsis> âœï¸ Step 3: Configuring IOMMU </span> </a> </li> <li class=md-nav__item> <a href=#step-4-blacklisting-driver-modules class=md-nav__link> <span class=md-ellipsis> ğŸš€ Step 4: Blacklisting Driver modules </span> </a> <nav class=md-nav aria-label="ğŸš€ Step 4: Blacklisting Driver modules"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adding-device-ids-to-blacklist class=md-nav__link> <span class=md-ellipsis> Adding Device ID's to Blacklist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-4-adding-devices-to-vm class=md-nav__link> <span class=md-ellipsis> â³ Step 4: Adding devices to VM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> â— Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> <span class=md-ellipsis> ğŸ“š Resources </span> </a> </li> <li class=md-nav__item> <a href=#revision-history class=md-nav__link> <span class=md-ellipsis> ğŸ”„ Revision History </span> </a> </li> <li class=md-nav__item> <a href=#additional-notes class=md-nav__link> <span class=md-ellipsis> ğŸ“ Additional Notes </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=how-to-proxmox-pcigpu-passthrough>ğŸ› ï¸ How To: Proxmox PCI/GPU Passthrough<a class=headerlink href=#how-to-proxmox-pcigpu-passthrough title="Permanent link">&para;</a></h1> <p>ğŸ‘¤ <strong>Author:</strong> Dwayne Black ğŸ“… <strong>Date:</strong> 16 Oct 25 ğŸ“Œ <strong>Version:</strong> 01.2025</p> <hr> <h2 id=overview>ğŸ“– Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>PCI passthrough allows you to use a physical PCI device (graphics card, network card) inside a VM (KVM virtualization only).</p> <p>If you "PCI passthrough" a device, the device is not available to the host anymore. Note that VMs with passed-through devices cannot be migrated.</p> <p>Good for Gfx cards passthrough direct to Plex/Jellyfin VM for transcoding etc.</p> <hr> <h2 id=prerequisites>ğŸ“‹ Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>ğŸ“¦ Item</th> <th>ğŸ“– Description</th> <th>ğŸ”¢ Version</th> </tr> </thead> <tbody> <tr> <td>Proxmox VE</td> <td>proxmox virtual environment</td> <td>9.0</td> </tr> <tr> <td>Motherboard</td> <td>VT-d/IOMMU capable Motherboard</td> <td></td> </tr> <tr> <td>PCI device</td> <td>SAS HBA, Gfx Card</td> <td></td> </tr> <tr> <td>Quick Reference</td> <td>https://pve.proxmox.com/wiki/PCI_Passthrough</td> <td></td> </tr> <tr> <td>Original Guide</td> <td><a href=https://github.com/HSVEOCT/docs/tree/main/guides/GPU%20Passthrough%20Guide/Passthrough%20Commands>HSVE Guide</a> Thank you!!</td> <td></td> </tr> </tbody> </table> <hr> <h2 id=step-by-step-guide>ğŸ§© Step-by-Step Guide<a class=headerlink href=#step-by-step-guide title="Permanent link">&para;</a></h2> <h3 id=step-1-prepare-bios>Step 1: Prepare BIOS<a class=headerlink href=#step-1-prepare-bios title="Permanent link">&para;</a></h3> <p>This prep is required to ensure that your system is compatible with 'passthrough' and you have the best chance of success. if possible, <strong>start by ensuring your BIOS firmware is up to date!</strong></p> <p>âœ… <strong>Enable SVM/Virtualization Mode</strong></p> <p>âœ… <strong>Enable VT-d</strong><br> _Required for passthrough to work at all</p> <p>âœ… <strong>Enable SR-IOV</strong><br> <em>If present.</em></p> <p>ğŸ›‘ <strong>Disable CSM/Legacy Boot</strong></p> <p>âœ… <strong>Enable ACS</strong><br> <em>If present, set to Enabled (Auto doesnâ€™t work).</em></p> <p>âœ… <strong>Set PEG {NUMBER} ASPM to L0 or L0sL1</strong><br> <em>Set whichever amount you've got to mentioned, if L0 is present, pick that.</em></p> <p>âœ… <strong>Enable 4G Decoding</strong></p> <p>ğŸ›‘ <strong>Disable Resizable BAR/Smart Access Memory</strong><br> <em>You might experience â€˜Code 43 errorâ€™ if enabled.</em></p> <p>âœ… <strong>Enable IOMMU</strong><br> _If present, mostly for AMD boards;</p> <p>âœ… <strong>Set Primary Display to CPU/iGPU</strong><br> <em>If your CPU has an iGPU, if not skip this.</em></p> <p>âœ… <strong>Set Pre-Allocated Memory to 64M</strong><br> <em>If your CPU has an iGPU, if not skip this too.</em></p> <div class="admonition attention"> <p class=admonition-title><strong>Attention</strong> - This step is not necessary for the pass-through, but helps keeping things clean. For ignoring some annoying â€œwarningsâ€ in yourÂ <code>dmesg</code>Â output, do the following:</p> </div> <p>Open: <div class=highlight><pre><span></span><code>nano /etc/modprobe.d/kvm.conf
</code></pre></div></p> <p>Add the following line: <div class=highlight><pre><span></span><code>options kvm ignore_msrs=Y report_ignored_msrs=0
</code></pre></div></p> <hr> <h3 id=step-2-setting-boot-arguments>ğŸ”§ Step 2: Setting Boot Arguments<a class=headerlink href=#step-2-setting-boot-arguments title="Permanent link">&para;</a></h3> <h4 id=for-intel-cpus>ForÂ <strong>Intel</strong>Â CPUs<a class=headerlink href=#for-intel-cpus title="Permanent link">&para;</a></h4> <p>ForÂ <strong>GRUB</strong>;<br> Replace the current similar line with this one in your grub file: <div class=highlight><pre><span></span><code>nano /etc/default/grub
</code></pre></div></p> <p>Make these changes to that file: <div class=highlight><pre><span></span><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt initcall_blacklist=sysfb_init&quot;
</code></pre></div></p> <div class="admonition attention"> <p class=admonition-title>Attention - This config is from a youtube video which seemed to work and display 'IOMMU Enabled' when checking as well:</p> </div> <div class=highlight><pre><span></span><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt intel_pstate=disable
</code></pre></div> <p>HitÂ <strong>Ctrl + X â†’ Y â†’ Enter</strong>Â to save changes.</p> <hr> <h4 id=for-amd-cpus>ForÂ <strong>AMD</strong>Â CPUs<a class=headerlink href=#for-amd-cpus title="Permanent link">&para;</a></h4> <p>ForÂ <strong>GRUB</strong>;<br> Replace the current similar line with this one in your grub file: <div class=highlight><pre><span></span><code>nano /etc/default/grub
</code></pre></div></p> <p>Make these changes to that file: <div class=highlight><pre><span></span><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet iommu=pt initcall_blacklist=sysfb_init&quot;
</code></pre></div></p> <p>HitÂ <strong>Ctrl + X â†’ Y â†’ Enter</strong>Â to save changes.</p> <hr> <div class="admonition attention"> <p class=admonition-title><strong>Attention</strong> - Your system might not be relying on Grub, butÂ <strong>systemd</strong>Â instead. This is often the case when youâ€™re usingÂ <strong>ZFS</strong>. So forÂ <strong>systemd</strong>:</p> </div> <h4 id=intel-cpus-systemdzfs>Intel CPUs (Systemd/ZFS)<a class=headerlink href=#intel-cpus-systemdzfs title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>nano /etc/kernel/cmdline
</code></pre></div> <div class=highlight><pre><span></span><code>root=ZFS=rpool/ROOT/pve-1 boot=zfs intel_iommu=on iommu=pt initcall_blacklist
=sysfb_init
</code></pre></div> <h4 id=amd-cpus-systemdzfs>AMD CPUs (Systemd/ZFS)<a class=headerlink href=#amd-cpus-systemdzfs title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>nano /etc/kernel/cmdline
</code></pre></div> <div class=highlight><pre><span></span><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet iommu=pt initcall_blacklist=sysfb_init&quot;
</code></pre></div> <hr> <p>ForÂ <strong>Grub</strong>Â only: <div class=highlight><pre><span></span><code>update-grub
</code></pre></div></p> <p>ForÂ <strong>Systemd</strong>Â only: <div class=highlight><pre><span></span><code>pve-efiboot-tool refresh
</code></pre></div></p> <p>Reboot to commit changes with: <div class=highlight><pre><span></span><code>reboot
</code></pre></div></p> <hr> <h3 id=step-3-configuring-iommu>âœï¸ Step 3: Configuring IOMMU<a class=headerlink href=#step-3-configuring-iommu title="Permanent link">&para;</a></h3> <p>Once the host is up and running again we need to check if IOMMU is enabled and working. We can do this by running the following commands.</p> <p>ForÂ <strong>Intel</strong>: <div class=highlight><pre><span></span><code>dmesg | grep -e DMAR -e IOMMU
</code></pre></div></p> <p>ForÂ <strong>AMD</strong>: <div class=highlight><pre><span></span><code>dmesg | grep -e DMAR -e IOMMU -e AMD-Vi
</code></pre></div></p> <p>If there's no output you've done something wrong, please retrace your steps: You should be seeing something like this: "DMAR: IOMMU Enabled"</p> <hr> <p>The next step is enabling the modules required for GPU passthrough: Enable the necessary modules by running the following command:</p> <div class=highlight><pre><span></span><code>nano /etc/modules
</code></pre></div> <p>Add the following lines to this file: <div class=highlight><pre><span></span><code>vfio
vfio_iommu_type1
vfio_pci
</code></pre></div></p> <p>HitÂ <strong>Ctrl</strong>Â +Â <strong>X</strong>Â &gt;Â <strong>Y</strong>Â <strong>Enter</strong>Â to Save changes.</p> <hr> <p>After changing the following modules you need to refresh your initramfs with the following command: <div class=highlight><pre><span></span><code>update-initramfs -u -k all
</code></pre></div></p> <p>Lets check if remapping has been enabled with the following command: <div class=highlight><pre><span></span><code>dmesg | grep remapping
</code></pre></div></p> <p>You should see something like "Interrupt remapping enabled / IRQ Remapping Enabled"</p> <p>If your system doesn't support Remapping you can run this command to enable remapping.Â <strong>However please be aware that this option could make your system unstable.</strong> <div class=highlight><pre><span></span><code>nano /etc/modprobe.d/iommu_unsafe_interrupts.conf
</code></pre></div></p> <p>Add the following line: <div class=highlight><pre><span></span><code>options vfio_iommu_type1 allow_unsafe_interrupts=1
</code></pre></div></p> <p>HitÂ <strong>Ctrl</strong>Â +Â <strong>X</strong>Â &gt;Â <strong>Y</strong>Â &gt;Â <strong>Enter</strong>Â to save your changes.</p> <hr> <h3 id=step-4-blacklisting-driver-modules>ğŸš€ Step 4: Blacklisting Driver modules<a class=headerlink href=#step-4-blacklisting-driver-modules title="Permanent link">&para;</a></h3> <p>Blacklisting driver modules to give VM full access to Hardware. <div class=highlight><pre><span></span><code>nano /etc/modprobe.d/pve-blacklist.conf 
</code></pre></div></p> <p>Add: <div class=highlight><pre><span></span><code>blacklist nouveau
blacklist nvidia
blacklist nvidiafb
blacklist snd_hda_codec_hdmi
blacklist snd_hda_intel
blacklist snd_hda_codec
blacklist snd_hda_core
blacklist radeon
blacklist amdgpu
</code></pre></div></p> <p>HitÂ <strong>Ctrl</strong>Â +Â <strong>X</strong>Â &gt;Â <strong>Y</strong>Â &gt;Â <strong>Enter</strong></p> <hr> <h4 id=adding-device-ids-to-blacklist>Adding Device ID's to Blacklist<a class=headerlink href=#adding-device-ids-to-blacklist title="Permanent link">&para;</a></h4> <p>To find the corresponding IDs for your PCI devices run the following command: <strong>Replace {device} = vga,usb,audio,wireless,sas etc.</strong> <div class=highlight><pre><span></span><code>lspci -nn | grep -i {device}
</code></pre></div></p> <p>You will see an output similar to the below screenshot:</p> <p>![[device id.png]]</p> <p>As you can see the IDs of the GPU above areÂ <strong>10de:1287</strong>Â andÂ <strong>1002:67d</strong>.</p> <p>You may decide you want to find the IDs of your USB controllers too just in case you need to whitelist these down the line due to issues.</p> <p>To blacklist the devices from use by Proxmox and full access use to your VM run the following commands.</p> <div class=highlight><pre><span></span><code>nano /etc/modprobe.d/vfio-pci.conf
</code></pre></div> <p>Add the device IDs in the blank file like this: <div class=highlight><pre><span></span><code>options vfio-pci ids=1234:5678,1234:5678 disable_vga=1
</code></pre></div></p> <p>Replacing theÂ <strong>1234:5678</strong>Â with your actual IDs, if you only have 1 GPU remove the other IDs from the command.</p> <p><em><strong>Example:</strong></em> <div class=highlight><pre><span></span><code>options vfio-pci ids=10de:1287 disable_vga=1
</code></pre></div></p> <p>You can also addÂ <strong>disable_idle_d3=1</strong>Â to the end of the line to disable the D3 device power state which will prevent certain hardware from entering low power mode, which can cause issues when passed through to VMs.</p> <p>HitÂ <strong>Ctrl</strong>Â +Â <strong>X</strong>Â &gt;Â <strong>Y</strong>Â &gt;Â <strong>Enter</strong>Â to save changes.</p> <p>Once all of the above is sorted reboot your machine once again with the command below: <div class=highlight><pre><span></span><code>reboot
</code></pre></div></p> <hr> <h3 id=step-4-adding-devices-to-vm>â³ Step 4: Adding devices to VM<a class=headerlink href=#step-4-adding-devices-to-vm title="Permanent link">&para;</a></h3> <p>(Coming Soon!)</p> <hr> <h2 id=troubleshooting>â— Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>ğŸš¨ Issue</th> <th>ğŸ“‹ Description</th> <th>âœ… Possible Solution</th> </tr> </thead> <tbody> <tr> <td></td> <td></td> <td></td> </tr> </tbody> </table> <hr> <h2 id=resources>ğŸ“š Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/HSVEOCT/docs/tree/main/guides/GPU%20Passthrough%20Guide/Passthrough%20Commands>ğŸ“– Original Guide that worked!</a></li> <li><a href=https://pve.proxmox.com/wiki/PCI_Passthrough>ğŸ”— Proxmox Wiki on PCI passthrough</a></li> <li><a href=https://pve.proxmox.com/pve-docs/pve-admin-guide.html>ğŸ”– Proxmox VW Administration Guide</a></li> <li>ğŸ¥ <a href="https://www.youtube.com/watch?v=Pjjyuk4YU78">Tutorial Video - 10 Oct 2025</a></li> </ul> <hr> <h2 id=revision-history>ğŸ”„ Revision History<a class=headerlink href=#revision-history title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>ğŸ“… Date</th> <th>ğŸ”– Version</th> <th>ğŸ‘¤ Author</th> <th>ğŸ“ Changes / Notes</th> </tr> </thead> <tbody> <tr> <td>16 Oct 2025</td> <td>2025.01</td> <td>Dwayne Black</td> <td>Initial draft</td> </tr> </tbody> </table> <hr> <h2 id=additional-notes>ğŸ“ Additional Notes<a class=headerlink href=#additional-notes title="Permanent link">&para;</a></h2> <p>Nothing of importance to note just yet.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.expand", "navigation.path", "navigation.sections", "content.code.annotate", "content.code.copy", "content.code.select", "search.suggest", "search.highlight", "search.share", "toc.follow", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>